{
  "metadata": {
    "name": "{{ extra_app.name }}{{ extra_volterra_site_id }}-{{ extra_env | lower }}",
    "namespace": "{{ extra_volterra_namespace }}",
    "labels": {
      "ves.io/app_type": "cloudbuilder",
      "owner": "{{ extra_owner_email.split('@')[0] }}",
      "project": "cloudbuilder"
    },
    "description": "NGINX workshop",
    "disable": false
  },
  "spec": {
    "domains": [
      "{{ extra_app.name }}{{ extra_volterra_site_id }}-{{ extra_env | lower }}.{{ extra_app.domain }}"
    ],
    "https_auto_cert": {
      "http_redirect": true,
      "add_hsts": true,
      "no_mtls": {},
      "tls_config": {
        "default_security": {}
      },
      "default_header": {},
      "enable_path_normalize": {}
    },
    "advertise_on_public_default_vip": {},
    "default_route_pools": [],
    "routes": [
      {
        "simple_route": {
          "http_method": "GET",
          "path": {
            "path": "/api/sentence"
          },
          "origin_pools": [
            {
              "pool": {
                "tenant": "{{ extra_volterra.tenant.full }}",
                "namespace": "{{ extra_volterra_namespace }}",
                "name": "{{ extra_app.name }}-generator"
              },
              "weight": 1,
              "priority": 1,
              "endpoint_subsets": {}
            }
          ],
          "headers": [],
          "disable_host_rewrite": {}
        }
      },
      {%- for prefix in ['/api/'] %}
      {
        "simple_route": {
          "http_method": "ANY",
          "path": {
            "prefix": "{{ prefix }}"
          },
          "origin_pools": [
              {
                "pool": {
                  "tenant": "{{ extra_volterra.tenant.full }}",
                  "namespace": "{{ extra_volterra_namespace }}",
                  "name": "{{ extra_app.name }}{{ extra_volterra_site_id }}-{{ extra_env }}-apigw"
                },
                "weight": 1,
                "priority": 1,
                "endpoint_subsets": {}
              }
          ],
          "disable_host_rewrite": {}
        }
      },
      {% endfor -%}
      {%- for prefix in ['/_codexch', '/userinfo', '/login', '/logout', '/_logout'] %}
      {
        "simple_route": {
          "http_method": "ANY",
          "path": {
            "prefix": "{{ prefix }}"
          },
          "origin_pools": [
              {
                "pool": {
                  "tenant": "{{ extra_volterra.tenant.full }}",
                  "namespace": "{{ extra_volterra_namespace }}",
                  "name": "{{ extra_app.name }}{{ extra_volterra_site_id }}-{{ extra_env }}-apigw"
                },
                "weight": 1,
                "priority": 1,
                "endpoint_subsets": {}
              }
          ],
          "disable_host_rewrite": {}
        }
      },
      {% endfor -%}
      {
        "simple_route": {
          "http_method": "ANY",
          "path": {
            "prefix": "/backgrounds"
          },
          "origin_pools": [
            {
              "pool": {
                "tenant": "{{ extra_volterra.tenant.full }}",
                "namespace": "{{ extra_volterra_namespace }}",
                "name": "{{ extra_app.name }}-backgrounds",
                "kind": "origin_pool"
              },
              "weight": 1,
              "priority": 1,
              "endpoint_subsets": {}
            }
          ],
          "headers": [],
          "disable_host_rewrite": {}
        }
      },
      {
        "simple_route": {
          "http_method": "ANY",
          "path": {
            "prefix": "/"
          },
          "origin_pools": [
              {
                "pool": {
                  "tenant": "{{ extra_volterra.tenant.full }}",
                  "namespace": "{{ extra_volterra_namespace }}",
                  "name": "{{ extra_app.name }}-frontend"
                },
                "weight": 1,
                "priority": 1,
                "endpoint_subsets": {}
              }
          ],
          "disable_host_rewrite": {}
        }
      }
    ],
    "app_firewall": {
      "tenant": "{{ extra_volterra.tenant.full }}",
      "namespace": "{{ extra_volterra_namespace }}",
      "name": "{{ extra_app.name }}"
    },
    "api_definition": {
      "tenant": "{{ extra_volterra.tenant.full }}",
      "namespace": "{{ extra_volterra_namespace }}",
      "name": "{{ extra_app.name }}{{ extra_volterra_site_id }}"
    },
    "add_location": true,
    "policy_based_challenge": {
      "default_js_challenge_parameters": {},
      "default_captcha_challenge_parameters": {},
      "default_mitigation_settings": {},
      "no_challenge": {},
      "rule_list": {
        "rules": []
      }
    },
    "user_identification": {
      "tenant": "{{ extra_volterra.tenant.full }}",
      "namespace": "shared",
      "name": "cloudbuilder-deviceid",
      "kind": "user_identification"
    },
    "disable_rate_limit": {},
    "waf_exclusion_rules": [],
    "blocked_clients": [],
    "trusted_clients": [],
    "ddos_mitigation_rules": [],
    "service_policies_from_namespace": {},
    "cookie_stickiness": {
      "name": "xc-session"
    },
    "multi_lb_app": {},
    "disable_bot_defense": {},
    "host_name": "",
    "dns_info": []
  }
}