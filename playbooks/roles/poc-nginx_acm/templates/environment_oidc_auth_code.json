{
    "name": "{{ extra_app.name }}{{ extra_volterra_site_id }}-{{ extra_environment | lower }}",
    "type": "{{ extra_environment }}",
    "metadata": {
        "description": "{{ extra_app.name }}{{ extra_volterra_site_id }} {{ extra_environment }}"
    },
    "systemProperties": {
        "acmHostName": "acm"
    },
    "functions": [
        "DEVPORTAL",
        "API-GATEWAY"
    ],
    "proxies": [
        {
            "hostnames": [
                "{{ extra_producer_name }}-{{ extra_app.name }}-{{ extra_environment | lower }}.{{ extra_app.domain }}"
            ],
            "proxyClusterName": "{{ extra_app.name }}{{ extra_volterra_site_id }}-{{ extra_environment | lower }}",
            "runtime": "GATEWAY-PROXY",
            "policies": {
                "oidc-authz": [
                  {
                    "metadata": {},
                    "systemMetadata": {
                      "appliedOn": "inbound",
                      "context": "global"
                    },
                    "action": {
                      "authFlowType": "AUTHCODE",
                      "authorizationEndpoint": "https://{{ extra_okta.tenant }}.okta.com/oauth2/{{ var_okta_auth_server_id }}/v1/authorize",
                      "errorReturnConditions": {
                        "noMatch": {
                          "returnCode": 403
                        },
                        "notSupplied": {
                          "returnCode": 401
                        }
                      },
                      "forwardTokenToBackend": "access_token",
                      "jwksURI": "https://{{ extra_okta.tenant }}.okta.com/oauth2/{{ var_okta_auth_server_id }}/v1/keys",
                      "logOffEndpoint": "https://{{ extra_okta.tenant }}.okta.com/oauth2/{{ var_okta_auth_server_id }}/v1/logout",
                      "returnTokenToClientOnLogin": "id_token",
                      "tokenEndpoint": "https://{{ extra_okta.tenant }}.okta.com/oauth2/{{ var_okta_auth_server_id }}/v1/token",
                      "uris": {
                        "loginURI": "/login",
                        "logoutURI": "/logout",
                        "redirectURI": "/_codexch",
                        "userInfoURI": "/userinfo"
                      },
                      "userInfoEndpoint": "https://{{ extra_okta.tenant }}.okta.com/oauth2/{{ var_okta_auth_server_id }}/v1/userinfo"
                    },
                    "data": [
                      {
                        "clientID": "{{ var_okta_app_client_id }}",
                        "scopes": "openid",
                        "source": "ACM"
                      }
                    ]
                  }
                ]
            }
        },
        {
            "hostnames": [
                "{{ extra_app.name }}{{ extra_volterra_site_id }}-{{ extra_environment | lower }}-devportal.{{ extra_app.domain }}"
            ],
            "proxyClusterName": "{{ extra_app.name }}{{ extra_volterra_site_id }}-{{ extra_environment | lower }}-devportal",
            "runtime": "PORTAL-PROXY",
            "policies": {}
        },
        {
            "hostnames": [
                "{{ extra_app.name }}{{ extra_volterra_site_id }}-{{ extra_environment | lower }}-devportal-internal.{{ extra_app.domain }}"
            ],
            "proxyClusterName": "{{ extra_app.name }}{{ extra_volterra_site_id }}-{{ extra_environment | lower }}-devportal",
            "runtime": "INT-PORTAL-ACM-PROXY",
            "policies": {}
        }
    ]
}